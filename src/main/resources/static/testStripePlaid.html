<button id='linkButton'>Open Plaid Link</button>
<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
<script>
var linkHandler = Plaid.create({
  env: 'sandbox',
  clientName: 'Stripe/Plaid Test',
  key: '5475e6f532d5bc20abca96dba0c94a',
  product: ['auth'],
  selectAccount: true,
  onSuccess: function(public_token, metadata) {
    // Send the public_token and account ID to your app server.
    console.log('public_token: ' + public_token);
    console.log('account ID: ' + metadata.account_id);
    var tokObj = new Object();
    tokObj.publicToken = public_token;
    tokObj.accountId = metadata.account_id;
    $.ajax({
        url: '/plaidtokens/new/1',
        type: 'post',
        data: JSON.stringify(tokObj),
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json' 
        },
        dataType: 'json',
        success: function (response) {
            console.log(response);
        }
    });

    // $.post('/plaidtokens/new', {
    //   "id": 5,
    //   "publicToken": public_token,
    //   "accountId": metadata.account_id
    // });
    // var tokObj = new Object();
    // tokObj.id = 5;
    // tokObj.publicToken = public_token;
    // tokObj.accountId = metadata.account_id;
    // $.postJSON = function(url, data, callback) {
    // return jQuery.ajax({
    //   headers: { 
    //       'Accept': 'application/json',
    //       'Content-Type': 'application/json' 
    //   },
    //   'type': 'POST',
    //   'url': url,
    //   'data': JSON.stringify(data),
    //   'dataType': 'json',
    //   'success': callback
    //   });
    // };
  },
  onExit: function(err, metadata) {
    // The user exited the Link flow.
    if (err != null) {
      // The user encountered a Plaid API error prior to exiting.
    }
  },
});

// Trigger the Link UI
document.getElementById('linkButton').onclick = function() {
  linkHandler.open();
};
</script>